<span>generator.ts</span><pre class="shiki" style="background-color: #1b1b1d"><code><span class="line"><span style="color: #DF61ED">import</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">fs</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">from</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;node:fs&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"><span style="color: #DF61ED">import</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">shiki</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">from</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;shiki&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"><span style="color: #DF61ED">import</span><span style="color: #BEBABF"> { </span><span style="color: #ED616F">getSVGRenderer</span><span style="color: #BEBABF"> } </span><span style="color: #DF61ED">from</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;shiki-renderer-svg&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"><span style="color: #DF61ED">import</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">JSON5</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">from</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;json5&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"><span style="color: #DF61ED">import</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">path</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">from</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;node:path&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #888589; font-style: italic">// This is the code used to generate the example images!</span></span>
<span class="line"></span>
<span class="line"><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #61B5ED">main</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">async</span><span style="color: #BEBABF"> () </span><span style="color: #DF61ED">=&gt;</span><span style="color: #BEBABF"> {</span></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">highlighter</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">await</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">shiki</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">getHighlighter</span><span style="color: #BEBABF">({</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">theme</span><span style="color: #BEBABF">: </span><span style="color: #EDDF61">JSON5</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">parse</span><span style="color: #BEBABF">(</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">fs</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">readFileSync</span><span style="color: #BEBABF">(</span><span style="color: #61ED99">&#39;themes</span><span style="color: #61EDDF">\\</span><span style="color: #61ED99">crepuscular-color-theme.json&#39;</span><span style="color: #BEBABF">, </span><span style="color: #61ED99">&#39;utf-8&#39;</span><span style="color: #BEBABF">)</span></span>
<span class="line"><span style="color: #BEBABF">        ),</span></span>
<span class="line"><span style="color: #BEBABF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">svgRenderer</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">await</span><span style="color: #BEBABF"> </span><span style="color: #61B5ED">getSVGRenderer</span><span style="color: #BEBABF">({</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">bg</span><span style="color: #BEBABF">: </span><span style="color: #ED616F">highlighter</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">getBackgroundColor</span><span style="color: #BEBABF">(),</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">fontFamily</span><span style="color: #BEBABF">: {</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">name</span><span style="color: #BEBABF">: </span><span style="color: #61ED99">&#39;Fira Code&#39;</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">cssURL</span><span style="color: #BEBABF">: </span><span style="color: #61ED99">&#39;https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&amp;display=swap&#39;</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">        },</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">fontSize</span><span style="color: #BEBABF">: </span><span style="color: #ED9961">14</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">bgSideCharPadding</span><span style="color: #BEBABF">: </span><span style="color: #ED9961">5</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">bgCornerRadius</span><span style="color: #BEBABF">: </span><span style="color: #ED9961">20</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #61B5ED">generateThemeSVG</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> (</span><span style="color: #ED616F; font-style: italic">inputPath</span><span style="color: #BEBABF">: </span><span style="color: #EDDF61">string</span><span style="color: #BEBABF">) </span><span style="color: #DF61ED">=&gt;</span><span style="color: #BEBABF"> {</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">_code</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">fs</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">readFileSync</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">inputPath</span><span style="color: #BEBABF">, </span><span style="color: #61ED99">&#39;utf-8&#39;</span><span style="color: #BEBABF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> [</span><span style="color: #EDDF61">directory</span><span style="color: #BEBABF">, </span><span style="color: #EDDF61">file</span><span style="color: #BEBABF">, </span><span style="color: #EDDF61">extension</span><span style="color: #BEBABF">] </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> [</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">path</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">dirname</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">inputPath</span><span style="color: #BEBABF">),</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">path</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">basename</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">inputPath</span><span style="color: #BEBABF">),</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">path</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">extname</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">inputPath</span><span style="color: #BEBABF">),</span></span>
<span class="line"><span style="color: #BEBABF">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">console</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">log</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">directory</span><span style="color: #BEBABF">, </span><span style="color: #ED616F">file</span><span style="color: #BEBABF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">tokens</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">highlighter</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">codeToThemedTokens</span><span style="color: #BEBABF">(</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">_code</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">extension</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">slice</span><span style="color: #BEBABF">(</span><span style="color: #ED9961">1</span><span style="color: #BEBABF">)</span></span>
<span class="line"><span style="color: #BEBABF">        );</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">out</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">svgRenderer</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">renderToSVG</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">tokens</span><span style="color: #BEBABF">);</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #ED616F">fs</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">writeFileSync</span><span style="color: #BEBABF">(</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">path</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">join</span><span style="color: #BEBABF">(</span></span>
<span class="line"><span style="color: #BEBABF">                </span><span style="color: #61ED99">&#39;assets/code pictures&#39;</span><span style="color: #BEBABF">,</span></span>
<span class="line"><span style="color: #BEBABF">                </span><span style="color: #61ED99">`</span><span style="color: #DF61ED">${</span><span style="color: #ED616F">file</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">slice</span><span style="color: #BEBABF">(</span><span style="color: #ED9961">0</span><span style="color: #BEBABF">, </span><span style="color: #ED616F">file</span><span style="color: #BEBABF">.</span><span style="color: #ED616F">length</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">-</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">extension</span><span style="color: #BEBABF">.</span><span style="color: #ED616F">length</span><span style="color: #BEBABF">)</span><span style="color: #DF61ED">}</span><span style="color: #61ED99">.svg`</span></span>
<span class="line"><span style="color: #BEBABF">            ),</span></span>
<span class="line"><span style="color: #BEBABF">            </span><span style="color: #ED616F">out</span></span>
<span class="line"><span style="color: #BEBABF">        );</span></span>
<span class="line"><span style="color: #BEBABF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">source</span><span style="color: #BEBABF"> </span><span style="color: #61EDDF">=</span><span style="color: #BEBABF"> </span><span style="color: #61ED99">&#39;assets/samples&#39;</span><span style="color: #BEBABF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">for</span><span style="color: #BEBABF"> (</span><span style="color: #DF61ED">const</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">file</span><span style="color: #BEBABF"> </span><span style="color: #DF61ED">of</span><span style="color: #BEBABF"> </span><span style="color: #ED616F">fs</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">readdirSync</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">source</span><span style="color: #BEBABF">)) {</span></span>
<span class="line"><span style="color: #BEBABF">        </span><span style="color: #DF61ED">void</span><span style="color: #BEBABF"> </span><span style="color: #61B5ED">generateThemeSVG</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">path</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">join</span><span style="color: #BEBABF">(</span><span style="color: #ED616F">source</span><span style="color: #BEBABF">, </span><span style="color: #ED616F">file</span><span style="color: #BEBABF">));</span></span>
<span class="line"><span style="color: #BEBABF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BEBABF">    </span><span style="color: #DF61ED">return</span><span style="color: #BEBABF"> </span><span style="color: #EDDF61">Promise</span><span style="color: #BEBABF">.</span><span style="color: #61B5ED">resolve</span><span style="color: #BEBABF">();</span></span>
<span class="line"><span style="color: #BEBABF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #DF61ED">void</span><span style="color: #BEBABF"> </span><span style="color: #61B5ED">main</span><span style="color: #BEBABF">();</span></span>
<span class="line"></span></code></pre>